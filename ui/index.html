<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>ASIAGOLD</title>

  <!-- Telegram WebApp -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    body {
      margin: 0;
      background: #ffffff;
      color: #1f1f1f;
    }

    /* ===== Fixed Logo Header ===== */
    .header {
      position: sticky;
      top: 0;
      z-index: 10;
      height: 88px;
      background: linear-gradient(180deg, #ffffff, #fafafa);
      border-bottom: 1px solid #f0e6c8;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header img {
      height: 48px;
    }

    /* ===== Content ===== */
    .container {
      padding: 20px 16px 32px;
      max-width: 420px;
      margin: 0 auto;
    }

    h2 {
      font-size: 16px;
      margin: 20px 0 12px;
      color: #b89b3c;
    }

    .field {
      display: flex;
      flex-direction: column;
      margin-bottom: 14px;
    }

    .field label {
      font-size: 13px;
      margin-bottom: 6px;
      color: #555;
    }

    .field input,
    .field select {
      padding: 12px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #e6e6e6;
      background: #fff;
    }

    .field input:focus,
    .field select:focus {
      outline: none;
      border-color: #d4af37;
    }

    /* ===== Buttons ===== */
    .btn {
      width: 100%;
      padding: 14px;
      font-size: 15px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
    }

    .btn-gold {
      background: linear-gradient(135deg, #d4af37, #f3e7b3);
      color: #000;
      margin-top: 8px;
    }

    .btn-outline {
      background: #fff;
      border: 1px dashed #d4af37;
      color: #7a661f;
    }

    .hint {
      font-size: 12px;
      margin-top: 6px;
      min-height: 14px;
    }

    .footer {
      text-align: center;
      font-size: 12px;
      margin-top: 24px;
      color: #777;
    }

    /* ===== Mobile Only Guard ===== */
    @media (min-width: 768px) {
      body::before {
        content: "این سامانه فقط از طریق موبایل و داخل تلگرام قابل استفاده است";
        position: fixed;
        inset: 0;
        background: #fff;
        color: #000;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 20px;
        z-index: 999;
      }
    }
  </style>
</head>

<body>

  <!-- Fixed Logo -->
  <div class="header">
    <img src="./assets/logo.svg" alt="ASIAGOLD">
  </div>

  <!-- Form -->
  <main class="container" aria-label="ثبت‌نام مشتری">

    <h2>اطلاعات دفتر فروش</h2>

    <!-- Office -->
    <div class="field">
      <label for="office">انتخاب دفتر فروش</label>
      <select id="office">
        <option value="">انتخاب کنید</option>
        <option value="tehran">دفتر تهران</option>
        <option value="isfahan">دفتر اصفهان</option>
        <option value="mashhad">دفتر مشهد</option>
      </select>
    </div>

    <!-- Full name -->
    <div class="field">
      <label for="fullname">نام و نام خانوادگی</label>
      <input id="fullname" placeholder="مثال: علی رضایی">
    </div>

    <!-- Phone -->
    <div class="field">
      <label>شماره موبایل</label>
      <button class="btn btn-outline" id="get-phone" type="button">
        دریافت شماره از تلگرام
      </button>
      <div class="hint" id="phone-status"></div>
    </div>

    <!-- Shop name -->
    <div class="field">
      <label for="shop">نام مغازه</label>
      <input id="shop" placeholder="مثال: طلافروشی رضایی">
    </div>

    <!-- Address -->
    <div class="field">
      <label for="address">آدرس</label>
      <input id="address" placeholder="شهر، خیابان، پلاک">
    </div>

    <!-- Submit -->
    <button class="btn btn-gold" id="signup" type="button">
      ثبت‌نام
    </button>

    <div class="hint" id="form-status"></div>
    <button class="btn btn-outline" id="go-dashboard" type="button" hidden>
      ورود به داشبورد
    </button>

    <div class="footer">
      ثبت‌نام پس از بررسی مدیریت فعال می‌شود
    </div>

  </main>

  <script>
    const DEV_BYPASS_SIGNUP = true;
    const tg = window.Telegram?.WebApp;
    tg?.ready();

    let phoneNumber = null;
    const signupButton = document.getElementById("signup");
    const goDashboardButton = document.getElementById("go-dashboard");
    signupButton.disabled = true;

    if (DEV_BYPASS_SIGNUP) {
      phoneNumber = true;
      signupButton.disabled = false;
      goDashboardButton.hidden = false;
    }

    document.getElementById("get-phone").onclick = () => {
      if (!tg || !tg.initDataUnsafe?.user?.phone_number) {
        document.getElementById("phone-status").innerText =
          "شماره تلفن فقط از طریق دکمه اشتراک‌گذاری تلگرام قابل دریافت است";
        return;
      }
      phoneNumber = true;
      document.getElementById("signup").disabled = false;
      document.getElementById("phone-status").innerText =
        "شماره موبایل دریافت شد";
      const maskedNumber = "****" + String(tg.initDataUnsafe.user.phone_number).slice(-4);
      document.getElementById("phone-status").innerText += ` ${maskedNumber}`;
    };

    document.getElementById("signup").onclick = () => {
      if (!phoneNumber) {
        document.getElementById("form-status").innerText =
          "ابتدا شماره موبایل را از تلگرام دریافت کنید";
        return;
      }
      document.getElementById("form-status").innerText =
        "درخواست ثبت‌نام ارسال شد";
      document.getElementById("go-dashboard").hidden = false;
    };

    document.getElementById("go-dashboard").onclick = () => {
      window.location.href = "user-dashboard.html";
    };
  </script>

</body>
</html>
