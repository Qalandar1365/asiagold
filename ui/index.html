<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AsiaGold</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: #ffffff;
  color: #020617;
}
.wrapper {
  min-height: 100vh;
  display: flex;
  justify-content: center;
  padding: 24px;
}
.card {
  width: 100%;
  max-width: 420px;
  border: 1px solid #e5e7eb;
  border-radius: 18px;
  padding: 22px;
}
h1 {
  font-size: 20px;
  margin-bottom: 16px;
  text-align: center;
}
input {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 12px;
  border: 1px solid #d1d5db;
  font-size: 14px;
}
button {
  width: 100%;
  margin-top: 16px;
  padding: 13px;
  border-radius: 14px;
  font-size: 15px;
  font-weight: bold;
  cursor: pointer;
  border: 2px solid #b5942f;
  background: linear-gradient(135deg,#f5d76e,#d4af37);
  color: #020617;
}
button:disabled {
  opacity: .5;
  cursor: not-allowed;
}
.text {
  font-size: 13px;
  line-height: 1.7;
  color: #374151;
}
.checkbox {
  display: flex;
  gap: 8px;
  margin-top: 12px;
  font-size: 13px;
}
</style>
</head>

<body>
<div class="wrapper">
  <div class="card" id="app">Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„â€¦</div>
</div>

<script>
(() => {
const tg = Telegram.WebApp;
const WORKER = "https://asiagold-api.qalandar65.workers.dev";
const app = document.getElementById("app");

tg.ready();
tg.expand();

let state = {
  first: "",
  last: "",
  phone: "",
  accepted: false
};

async function auth() {
  const r = await fetch(WORKER, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ initData: tg.initData })
  });
  const j = await r.json();
  if (j.ok && j.registered) {
    renderLoggedIn();
  } else {
    renderForm();
  }
}

function renderForm() {
  app.innerHTML = `
    <h1>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h1>
    <input id="first" placeholder="Ù†Ø§Ù…">
    <input id="last" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">
    <button id="phone">ğŸ“± Ø¯Ø±ÛŒØ§ÙØª Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</button>

    <div class="checkbox">
      <input type="checkbox" id="rules">
      <label>Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±Ù…</label>
    </div>

    <button id="submit" disabled>ØªØ£ÛŒÛŒØ¯ Ù†Ù‡Ø§ÛŒÛŒ</button>
  `;

  ["first","last"].forEach(id=>{
    document.getElementById(id).oninput = e=>{
      state[id]=e.target.value.trim();
      check();
    };
  });

  document.getElementById("rules").onchange = e=>{
    state.accepted=e.target.checked;
    check();
  };

  document.getElementById("phone").onclick = ()=>{
    tg.requestContact((ok,res)=>{
      if(ok){
        state.phone=res.phone_number;
        check();
        alert("Ø´Ù…Ø§Ø±Ù‡ Ø«Ø¨Øª Ø´Ø¯ âœ…");
      }
    });
  };

  document.getElementById("submit").onclick = submit;
}

function check() {
  document.getElementById("submit").disabled = !(
    state.first && state.last && state.phone && state.accepted
  );
}

async function submit() {
  await fetch(WORKER, {
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({
      initData: tg.initData,
      profile: state
    })
  });
  renderPending();
}

function renderPending() {
  app.innerHTML = `
    <h1>Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯</h1>
    <p class="text">
      Ù¾Ø³ Ø§Ø² ØªØ£ÛŒÛŒØ¯ Ù…Ø¯ÛŒØ±ØŒ Ú©Ø¯ ÙˆØ±ÙˆØ¯ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
    </p>
  `;
}

function renderLoggedIn() {
  app.innerHTML = `
    <h1>Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h1>
    <p class="text">ÙˆØ§Ø±Ø¯ Ø³Ø§Ù…Ø§Ù†Ù‡ Ø´Ø¯ÛŒØ¯ âœ…</p>
  `;
}

auth();
})();
</script>
</body>
</html>
