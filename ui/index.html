<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AsiaGold</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: #fff;
  color: #020617;
}
.wrapper {
  min-height: 100vh;
  display: flex;
  justify-content: center;
  padding: 24px;
}
.card {
  width: 100%;
  max-width: 399px;
  border: 1px solid #e5e7eb;
  border-radius: 18px;
  padding: 22px;
}
h1 {
  text-align: center;
  font-size: 20px;
  margin-bottom: 14px;
}
input {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 12px;
  border: 1px solid #d1d5db;
  font-size: 14px;
}
button {
  width: 100%;
  margin-top: 14px;
  padding: 13px;
  border-radius: 14px;
  font-size: 15px;
  font-weight: bold;
  cursor: pointer;
  border: 2px solid #b5942f;
  background: linear-gradient(135deg,#f5d76e,#d4af37);
  color: #020617;
}
button:disabled {
  opacity: .5;
  cursor: not-allowed;
}
.rules {
  font-size: 13px;
  color: #374151;
  margin-top: 14px;
  line-height: 1.7;
}
.checkbox {
  display: flex;
  gap: 8px;
  margin-top: 10px;
  font-size: 13px;
}
</style>
</head>

<body>
<div class="wrapper">
  <div class="card" id="app">در حال اتصال…</div>
</div>

<script>
(() => {
const tg = Telegram.WebApp;
const WORKER = "https://asiagold-api.qalandar65.workers.dev";
const app = document.getElementById("app");

tg.ready();
tg.expand();

let state = {
  first: "",
  last: "",
  accepted: false
};

function check() {
  document.getElementById("submit").disabled = !(
    state.first &&
    state.last &&
    state.accepted
  );
}

async function start() {
  const r = await fetch(WORKER,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ initData: tg.initData })
  });
  const j = await r.json();

  if (j.ok && j.registered) {
    renderPassed();
  } else {
    renderRegister();
  }
}

function renderRegister() {
  app.innerHTML = `
    <h1>ثبت‌نام</h1>

    <input id="first" placeholder="نام">
    <input id="last" placeholder="نام خانوادگی">

    <div class="rules">
      1. ثبت سفارش فقط پس از تأیید مدیر معتبر است.<br>
      2. مسئولیت صحت اطلاعات با کاربر است.<br>
      3. اطلاعات محرمانه نگهداری می‌شود.<br>
      4. هر حساب فقط برای یک شخص است.
    </div>

    <div class="checkbox">
      <input type="checkbox" id="rulesCheck">
      <label>قوانین را می‌پذیرم</label>
    </div>

    <button id="submit" disabled>ادامه</button>
  `;

  document.getElementById("first").oninput = e => {
    state.first = e.target.value.trim(); check();
  };
  document.getElementById("last").oninput = e => {
    state.last = e.target.value.trim(); check();
  };
  document.getElementById("rulesCheck").onchange = e => {
    state.accepted = e.target.checked; check();
  };

  document.getElementById("submit").onclick = async () => {
    await fetch(WORKER,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({
        initData: tg.initData,
        profile: state,
        action: "temp_register"
      })
    });
    renderPending();
  };
}

function renderPending() {
  app.innerHTML = `
    <h1>ثبت شد</h1>
    <p style="text-align:center;font-size:14px">
      ثبت‌نام شما انجام شد ✅<br>
      به مرحله بعد منتقل می‌شوید.
    </p>
  `;
}

function renderPassed() {
  app.innerHTML = `
    <h1>خوش آمدید</h1>
    <p style="text-align:center;font-size:14px">
      وارد سامانه شدید ✅
    </p>
  `;
}

start();
})();
</script>
</body>
</html>
