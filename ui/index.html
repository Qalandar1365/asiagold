<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AsiaGold</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: #fff;
  color: #020617;
}
.wrapper {
  min-height: 100vh;
  display: flex;
  justify-content: center;
  padding: 24px;
}
.card {
  width: 100%;
  max-width: 399px;
  border: 1px solid #e5e7eb;
  border-radius: 18px;
  padding: 22px;
}
h1 {
  text-align: center;
  font-size: 20px;
  margin-bottom: 14px;
}
input {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  border-radius: 12px;
  border: 1px solid #d1d5db;
  font-size: 14px;
}
input[readonly] {
  background: #f3f4f6;
}
.phone-row {
  display: flex;
  gap: 8px;
  margin-top: 10px;
}
.phone-row input {
  flex: 1;
  margin-top: 0;
}
.phone-row button {
  width: 90px;
  padding: 0;
  font-size: 12px;
}
button {
  margin-top: 14px;
  padding: 13px;
  border-radius: 14px;
  font-size: 15px;
  font-weight: bold;
  cursor: pointer;
  border: 2px solid #b5942f;
  background: linear-gradient(135deg,#f5d76e,#d4af37);
  color: #020617;
}
button:disabled {
  opacity: .5;
  cursor: not-allowed;
}
.rules {
  font-size: 13px;
  color: #374151;
  margin-top: 14px;
  line-height: 1.7;
}
.checkbox {
  display: flex;
  gap: 8px;
  margin-top: 10px;
  font-size: 13px;
}
</style>
</head>

<body>
<div class="wrapper">
  <div class="card" id="app">Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„â€¦</div>
</div>

<script>
(() => {
const tg = Telegram.WebApp;
const WORKER = "https://asiagold-api.qalandar65.workers.dev";
const app = document.getElementById("app");

tg.ready();
tg.expand();

let state = {
  first: "",
  last: "",
  phone: "",
  accepted: false
};

function check() {
  document.getElementById("submit").disabled = !(
    state.first &&
    state.last &&
    state.phone &&
    state.accepted
  );
}

async function start() {
  const r = await fetch(WORKER,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ initData: tg.initData })
  });
  const j = await r.json();

  if (j.ok && j.registered) {
    renderOTP();
  } else {
    renderRegister();
  }
}

function renderRegister() {
  app.innerHTML = `
    <h1>Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</h1>

    <input id="first" placeholder="Ù†Ø§Ù…">
    <input id="last" placeholder="Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ">

    <div class="phone-row">
      <input id="phone" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„" readonly>
      <button id="getPhone">ğŸ“±</button>
    </div>

    <div class="rules">
      1. Ø«Ø¨Øª Ø³ÙØ§Ø±Ø´ ÙÙ‚Ø· Ù¾Ø³ Ø§Ø² ØªØ£ÛŒÛŒØ¯ Ù…Ø¯ÛŒØ± Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.<br>
      2. Ù…Ø³Ø¦ÙˆÙ„ÛŒØª ØµØ­Øª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ú©Ø§Ø±Ø¨Ø± Ø§Ø³Øª.<br>
      3. Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø­Ø±Ù…Ø§Ù†Ù‡ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.<br>
      4. Ù‡Ø± Ø­Ø³Ø§Ø¨ ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ø´Ø®Øµ Ø§Ø³Øª.
    </div>

    <div class="checkbox">
      <input type="checkbox" id="rulesCheck">
      <label>Ù‚ÙˆØ§Ù†ÛŒÙ† Ø±Ø§ Ù…ÛŒâ€ŒÙ¾Ø°ÛŒØ±Ù…</label>
    </div>

    <button id="submit" disabled>Ø¯Ø±ÛŒØ§ÙØª Ú©Ø¯ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ</button>
  `;

  document.getElementById("first").oninput = e => {
    state.first = e.target.value.trim(); check();
  };
  document.getElementById("last").oninput = e => {
    state.last = e.target.value.trim(); check();
  };
  document.getElementById("rulesCheck").onchange = e => {
    state.accepted = e.target.checked; check();
  };

  document.getElementById("getPhone").onclick = async () => {
    try {
      const result = await tg.requestContact();
      if (result?.contact?.phone_number) {
        state.phone = result.contact.phone_number;
        document.getElementById("phone").value = state.phone;
        check();
      } else {
        alert("Ø´Ù…Ø§Ø±Ù‡ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯");
      }
    } catch {
      alert("Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ø´Ù…Ø§Ø±Ù‡ Ø±Ø¯ Ø´Ø¯");
    }
  };

  document.getElementById("submit").onclick = async () => {
    await fetch(WORKER,{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({
        initData: tg.initData,
        profile: state,
        action: "send_otp"
      })
    });
    renderOTPSent();
  };
}

function renderOTPSent() {
  app.innerHTML = `
    <h1>Ú©Ø¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯</h1>
    <p style="text-align:center;font-size:14px">
      Ú©Ø¯ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯<br>
      Ø§Ø¹ØªØ¨Ø§Ø±: Û³Û° Ø¯Ù‚ÛŒÙ‚Ù‡
    </p>
  `;
}

function renderOTP() {
  app.innerHTML = `
    <h1>ÙˆØ±ÙˆØ¯</h1>
    <input placeholder="Ú©Ø¯ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ">
    <button>ØªØ£ÛŒÛŒØ¯</button>
  `;
}

start();
})();
</script>
</body>
</html>
